---
import { Image } from 'astro:assets'
import quoteIcon from '@/assets/images/quote.svg'
import ChevronLeft from '~icons/lucide/chevron-left'
import ChevronRight from '~icons/lucide/chevron-right'

const testimonials = [
    {
        id: 1,
        text: 'Uma escola que acolhe e transforma. Ver o desenvolvimento do meu filho aqui é gratificante. A equipe é sensacional e o ambiente é muito seguro.',
        author: 'Ana Clara Villa',
        role: 'Mãe de aluno do Fundamental',
        image: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=2600&auto=format&fit=crop'
    },
    {
        id: 2,
        text: 'A metodologia de ensino é excelente, preparando os alunos para o futuro com valores sólidos. Sinto que fiz a melhor escolha para a educação da minha filha.',
        author: 'Roberto Silva',
        role: 'Pai de aluna do Ensino Médio',
        image: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=2600&auto=format&fit=crop'
    },
    {
        id: 3,
        text: 'O carinho que os professores têm com as crianças é o diferencial. Minha filha ama ir para a escola todos os dias!',
        author: 'Mariana Santos',
        role: 'Mãe de aluna da Educação Infantil',
        image: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?q=80&w=2600&auto=format&fit=crop'
    }
]
---

<section class="relative w-full py-16 testimonials-section">
    <div class="w-full flex items-center lg:justify-end mb-8">
        <h2 class="w-full lg:w-1/2 lg:pl-36 text-4xl lg:text-5xl xl:text-6xl font-extrabold text-[#009640] leading-tight flex items-center lg:items-start justift-start flex-col">
            <span>Quem ama</span>
            <span>Quem cuida</span>
            <span>Quem Participa</span>
            <span>Quem confia</span>
        </h2>
    </div>
    <div class="relative container mx-auto px-4">

        <div class="slider-container relative min-h-[300px]">
            {testimonials.map((t, index) => (
                <blockquote 
                    class={`testimonial-slide bg-white text-center flex items-center justify-center flex-col gap-4 lg:gap-6 rounded-xl p-8 lg:p-12 shadow-xl absolute top-0 left-0 w-full transition-opacity duration-500 ${index === 0 ? 'opacity-100 z-10 relative' : 'opacity-0 z-0 pointer-events-none'}`}
                    data-index={index}
                >
                     <div class="absolute -top-4 lg:top-8 left-8 w-12 lg:w-16 h-12 lg:h-16 z-20">
                        <Image src={quoteIcon} alt="Citação" class="w-full h-full object-contain" />
                    </div>
                    <div class="absolute -bottom-4 lg:bottom-8 right-8 w-12 lg:w-16 h-12 lg:h-16 z-20 rotate-180">
                        <Image src={quoteIcon} alt="Citação" class="w-full h-full object-contain" />
                    </div>
                    <p class="text-lg lg:text-xl text-[#009640] max-w-[780px] font-medium leading-relaxed">
                        {t.text}
                    </p>
                    <div>
                        <h4 class="font-bold text-slate-800 text-lg">
                            {t.author}
                        </h4>
                        <p class="text-sm text-gray-500 uppercase tracking-wide">
                            {t.role}
                        </p>
                    </div>
                </blockquote>
            ))}
        </div>

        <div class="flex items-center justify-center gap-4 mt-8">
            <button
                id="prev-btn"
                class="p-2 rounded-full border-2 border-[#009640] text-[#009640] hover:bg-[#009640] hover:text-white transition-colors"
                aria-label="Anterior"
            >
                <ChevronLeft width="24" height="24" />
            </button>
            <button
                id="next-btn"
                class="p-2 rounded-full border-2 border-[#009640] text-[#009640] hover:bg-[#009640] hover:text-white transition-colors"
                aria-label="Próximo"
            >
                <ChevronRight width="24" height="24" />
            </button>
        </div>
    </div>
    <div class="absolute top-0 left-0 h-full w-1/2 -z-10 bg-yellow-100 opacity-50"></div>
</section>

<script>
    const section = document.querySelector('.testimonials-section')
    if (section) {
        const slides = section.querySelectorAll('.testimonial-slide')
        const prevBtn = section.querySelector('#prev-btn')
        const nextBtn = section.querySelector('#next-btn')
        let currentIndex = 0
        const total = slides.length

        function showSlide(index: number) {
            slides.forEach((slide, i) => {
                if (i === index) {
                    slide.classList.remove('opacity-0', 'z-0', 'pointer-events-none', 'absolute')
                    slide.classList.add('opacity-100', 'z-10', 'relative')
                } else {
                    slide.classList.remove('opacity-100', 'z-10', 'relative')
                    slide.classList.add('opacity-0', 'z-0', 'pointer-events-none', 'absolute')
                }
            })
            currentIndex = index
        }

        nextBtn?.addEventListener('click', () => {
            showSlide((currentIndex + 1) % total)
        })

        prevBtn?.addEventListener('click', () => {
            showSlide((currentIndex - 1 + total) % total)
        })
    }
</script>

---
import X from '~icons/lucide/x'

interface Props {
  id: string
}

const { id } = Astro.props
---

<dialog
  id={id}
  class="group fixed inset-0 z-50 w-full h-full p-0 m-0 bg-transparent backdrop:bg-black/80 backdrop:backdrop-blur-sm transition-opacity opacity-0 pointer-events-none open:opacity-100 open:pointer-events-auto"
>
  <div class="fixed inset-0 flex items-center justify-center p-4" data-close-modal>
    <div class="relative w-full max-w-4xl aspect-video bg-black rounded-2xl overflow-hidden shadow-2xl scale-95 opacity-0 transition-all duration-300 group-open:scale-100 group-open:opacity-100">
      <button
        type="button"
        class="absolute top-4 right-4 z-10 p-2 bg-black/50 hover:bg-black/70 text-white rounded-full transition-colors backdrop-blur-sm"
        data-close-modal
        aria-label="Fechar vÃ­deo"
      >
        <X width="24" height="24" />
      </button>
      <div id={`${id}-content`} class="w-full h-full">
        <!-- Content injected via JS -->
      </div>
    </div>
  </div>
</dialog>

<script define:vars={{ id }}>
  const dialog = document.getElementById(id)
  const contentContainer = document.getElementById(`${id}-content`)

  if (dialog && contentContainer) {
    dialog.addEventListener('click', (e) => {
      if (e.target.hasAttribute('data-close-modal')) {
        closeModal()
      }
    })

    // Expose open function globally or listen for event
    window.openVideoModal = (videoId) => {
      const iframe = document.createElement('iframe')
      iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`
      iframe.title = "YouTube video player"
      iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      iframe.allowFullscreen = true
      iframe.classList.add('w-full', 'h-full')
      
      contentContainer.innerHTML = ''
      contentContainer.appendChild(iframe)
      
      dialog.showModal()
      document.body.style.overflow = 'hidden'
    }

    function closeModal() {
      dialog.close()
      // Give a small timeout for animation if needed, or just clear immediately
      setTimeout(() => {
        contentContainer.innerHTML = ''
      }, 300)
      document.body.style.overflow = ''
    }

    // Handle Esc key natively by dialog, but we need to cleanup
    dialog.addEventListener('close', () => {
        contentContainer.innerHTML = ''
        document.body.style.overflow = ''
    })
  }
</script>

<style>
  dialog {
    display: block; /* Override default hidden */
  }
  dialog:not([open]) {
    display: none;
  }
</style>

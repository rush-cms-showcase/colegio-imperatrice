---
import Layout from '@/layouts/layout.astro'
import { rush, getCollectionId } from "@/lib/rush"

export async function getStaticPaths() {
    try {
        const collectionId = getCollectionId('/blog')
        const response: any = await rush.getEntries(collectionId, { limit: 1000 })
        const items = response.data || []

        return items.map((item: any) => ({
            params: { slug: item.slug },
            props: { item },
        }))
    } catch (e) {
        console.error('Failed to fetch blog entries:', e)
        return []
    }
}

const { item } = Astro.props
---

<Layout title={item.title}>
    <article class="bg-gray-50 min-h-screen pb-20">
        {item.featured_image ? (
            <div class="w-full h-[50vh] min-h-[400px] relative overflow-hidden">
                <div 
                    class="absolute inset-0 bg-cover bg-center"
                    style={`background-image: url('${item.featured_image.url}')`}
                />
                <div class="absolute inset-0 bg-black/40" />
                <div class="container mx-auto px-4 h-full flex flex-col justify-end pb-12 relative z-10">
                     <div class="max-w-4xl mx-auto w-full">
                         <a href="/blog" class="inline-flex items-center text-white/90 hover:text-white mb-6 uppercase tracking-wider text-sm font-medium transition-colors">
                            &larr; Voltar para Blog
                        </a>
                        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-4 leading-tight">
                            {item.title}
                        </h1>
                         <div class="flex items-center gap-4 text-white/90 text-sm md:text-base font-medium uppercase tracking-wider">
                             <time datetime={item.published_at || item.created_at}>
                                {new Date(item.published_at || item.created_at).toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' })}
                            </time>
                         </div>
                     </div>
                </div>
            </div>
        ) : (
            <div class="bg-[#009640] py-20 md:py-32">
                 <div class="container mx-auto px-4 relative z-10">
                     <div class="max-w-4xl mx-auto w-full">
                         <a href="/blog" class="inline-flex items-center text-white/90 hover:text-white mb-6 uppercase tracking-wider text-sm font-medium transition-colors">
                            &larr; Voltar para Blog
                        </a>
                        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-4 leading-tight">
                            {item.title}
                        </h1>
                         <div class="flex items-center gap-4 text-white/90 text-sm md:text-base font-medium uppercase tracking-wider">
                             <time datetime={item.published_at || item.created_at}>
                                {new Date(item.published_at || item.created_at).toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' })}
                            </time>
                         </div>
                     </div>
                </div>
            </div>
        )}

        <div class="container mx-auto px-4 -mt-10 relative z-20">
            <div class="max-w-4xl mx-auto bg-white p-8 md:p-12 lg:p-16 rounded-xl shadow-lg">
                <div class="prose prose-lg prose-green max-w-none text-gray-800 leading-relaxed">
                     <Fragment set:html={item.content} />
                </div>
            </div>
        </div>
    </article>
</Layout>
